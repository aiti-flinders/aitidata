---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}

library(dplyr)
library(stringr)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

write_metadata <- function() {
 included_data <-  data.frame(data(package = "aitidata")$results)[-c(1, 2)] |> 
   dplyr::mutate(Item = paste0("aitidata::", Item))
 
 date_max <- purrr::map(.x = included_data$Item, .f = ~safe_max(.x)) |> 
   purrr::list_c() 
 
 date_max <- data.frame(date_max)

 dplyr::bind_cols(included_data, date_max) |> 
   dplyr::mutate(Item = stringr::str_remove_all(Item, "aitidata::")) |> 
   dplyr::rename("Data Name" = Item,
          "Description" = Title,
          "Most Recent Data" = date_max) |>   
   dplyr::arrange(desc(`Most Recent Data`))
 
}

safe_max <- function(df) {
  
  df <- lazyeval::lazy_eval(df)
  
  if ("date" %in% colnames(df)) {
    
    r <- max(df$date)
    
  }
  
  else {
    r <- NA
  }
  
  names(r) <- "date"
  r
}
```

# aitidata

<!-- badges: start -->
[![R-CMD-check](https://github.com/aiti-flinders/aitidata/actions/workflows/R-CMD-check.yaml/badge.svg?branch=data_prep)](https://github.com/aiti-flinders/aitidata/actions/workflows/R-CMD-check.yaml)
[![update-abs](https://github.com/aiti-flinders/aitidata/workflows/update-abs/badge.svg)](https://github.com/aiti-flinders/aitidata/actions)

<!-- badges: end -->

`aitidata` is a collection of data sets commonly used by researchers at the Australian Industrial Transformation Institute. Data is updated at about 11:30am each day. 

The current version of `aitidata` is `r packageVersion("aitidata")`

Data was last updated `r as.Date(Sys.time(), tz = "Australia/Adelaide")` 

## Installation

You can install the latest version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("aiti-flinders/aitidata")
```



## Included data

``` {r, echo = FALSE}

knitr::kable(write_metadata())

```
